(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{2756:function(e,o,t){"use strict";function n(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}t.r(o),t.d(o,{default:function(){return y}});var r=t(7294);function i(e,o,t,n,r,i,a){try{var u=e[i](a),c=u.value}catch(l){return void t(l)}u.done?o(c):Promise.resolve(c).then(n,r)}function a(e){return function(){var o=this,t=arguments;return new Promise((function(n,r){var a=e.apply(o,t);function u(e){i(a,n,r,u,c,"next",e)}function c(e){i(a,n,r,u,c,"throw",e)}u(void 0)}))}}function u(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=t(7757),l=t.n(c);function s(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function p(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?s(Object(t),!0).forEach((function(o){n(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var f=function(){function e(o){var t=o.playOptions;!function(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"audioContext",void 0),n(this,"bufferSource",void 0),n(this,"gain",void 0),n(this,"playOptions",void 0),console.log("audio context creating..."),this.audioContext=new AudioContext,this.bufferSource=null,this.gain=null,this.playOptions=t,console.log("audio context successfully created")}var o,t,r;return o=e,(t=[{key:"play",value:function(e){var o=this,t=e.file,n=e.onNextLoop,r=new FileReader;r.onloadend=a(l().mark((function e(){var t,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r.result&&"string"!==typeof r.result){e.next=3;break}return console.log("file load failed"),e.abrupt("return");case 3:if(console.log("file successfully loaded"),console.log("audio preparing..."),o.bufferSource=o.audioContext.createBufferSource(),o.gain=o.audioContext.createGain(),null!==o.bufferSource&&null!==o.gain){e.next=10;break}return console.log("bufferSource or gain not initialized (bug?)"),e.abrupt("return");case 10:return o.bufferSource.connect(o.gain),o.gain.connect(o.audioContext.destination),console.log("audio successfully prepared"),console.log("audio decoding..."),e.next=16,o.audioContext.decodeAudioData(r.result);case 16:t=e.sent,console.log("audio successfully decoded"),console.log("audio play starting..."),o.bufferSource.buffer=t,o.bufferSource.playbackRate.setValueAtTime(o.playOptions.speed,0),o.gain.gain.setValueAtTime(o.playOptions.volume,0),o.bufferSource.start(0),console.log("audio play successfully started"),i=function(){var e=a(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("audio stopped"),o.bufferSource&&o.playOptions.loop&&(console.log("next loop starting..."),o.playOptions.randomizeSpeedEachLoop&&(o.playOptions=p(p({},o.playOptions),{},{speed:.01*Math.round((1.75*Math.random()+.25)/.01)})),o.bufferSource=o.audioContext.createBufferSource(),o.gain=o.audioContext.createGain(),o.bufferSource.connect(o.gain),o.gain.connect(o.audioContext.destination),o.bufferSource.buffer=t,o.bufferSource.playbackRate.setValueAtTime(o.playOptions.speed,0),o.gain.gain.setValueAtTime(o.playOptions.volume,0),o.bufferSource.start(0),o.bufferSource.onended=i,n({nextPlayOptions:o.playOptions}),console.log("next loop successfully started"));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),o.bufferSource.onended=i;case 26:case"end":return e.stop()}}),e)}))),r.readAsArrayBuffer(t),console.log("file read started")}},{key:"stop",value:function(){this.bufferSource&&(console.log("audio stopping..."),this.bufferSource.onended=null,this.bufferSource.stop(0),console.log("audio successfully stopped"))}},{key:"setPlayOptions",value:function(e){this.playOptions=e,null!==this.bufferSource&&null!==this.gain&&(this.bufferSource.playbackRate.setValueAtTime(this.playOptions.speed,0),this.gain.gain.setValueAtTime(this.playOptions.volume,0))}}])&&u(o.prototype,t),r&&u(o,r),e}(),d=t(5893);function b(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function g(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?b(Object(t),!0).forEach((function(o){n(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var y=function(){var e=(0,r.useState)(null),o=e[0],t=e[1],n=(0,r.useState)(!1),i=n[0],a=n[1],u=(0,r.useState)({loop:!1,randomizeSpeedEachLoop:!1,speed:1,volume:1}),c=u[0],l=u[1];function s(e){var t=g(g({},c),e);if(!o)return console.log("audio not initialized (bug?)"),void l(t);o.setPlayOptions(t),l(t)}return(0,r.useEffect)((function(){t(new f({playOptions:c}))}),[]),(0,d.jsx)("div",{style:{backgroundColor:i?"lightyellow":"white",height:"100%",left:0,position:"absolute",top:0,width:"100%"},onDragOver:function(e){e.stopPropagation(),e.preventDefault(),a(!0)},onDrop:function(e){if(console.log("file select detected"),e.stopPropagation(),e.preventDefault(),a(!1),o){var t=e.dataTransfer.files[0];o.stop(),o.play({file:t,onNextLoop:function(e){var o=e.nextPlayOptions;l(o)}})}else console.log("audio not initialized (bug?)")},onDragLeave:function(e){a(!1)},children:(0,d.jsxs)("ul",{children:[(0,d.jsxs)("li",{children:["Volume:",(0,d.jsx)("input",{type:"range",min:"0",max:"2",step:"0.01",value:c.volume,onChange:function(e){s({volume:Number(e.target.value)})}}),c.volume]}),(0,d.jsxs)("li",{children:["Speed:",(0,d.jsx)("input",{type:"range",min:"0.25",max:"2",step:"0.01",value:c.speed.toFixed(2),onChange:function(e){s({speed:Number(e.target.value)})}}),c.speed]}),(0,d.jsxs)("li",{children:["Loop:",(0,d.jsx)("input",{type:"checkbox",checked:c.loop,onChange:function(e){s({loop:e.target.checked})}}),c.loop?"Enabled":"Disabled"]}),c.loop&&(0,d.jsx)("ul",{children:(0,d.jsxs)("li",{children:["Randomize speed:",(0,d.jsx)("input",{type:"checkbox",checked:c.randomizeSpeedEachLoop,onChange:function(e){s({randomizeSpeedEachLoop:e.target.checked})}}),c.randomizeSpeedEachLoop?"Enabled":"Disabled"]})})]})})}},5301:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(2756)}])}},function(e){e.O(0,[774,888,179],(function(){return o=5301,e(e.s=o);var o}));var o=e.O();_N_E=o}]);